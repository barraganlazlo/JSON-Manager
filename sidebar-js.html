<script>
    var json;
    var columnArray = new Array();
    $(document).ready(function() {
        $("#bttn-copy").click(copy);
        $("#bttn-download").click(download);
        $("#bttn-update").click(update);
        $("#bttn-setColumnArray").click(setColumnArray);
        $("#bttn-deleteColumnArray").click(deleteColumnArray);
        $("#columnArrayId").keyup(lettersOnly);
    });

    function copy() {
        console.log("copy");
        var $temp = $("<input>");
        $("body").append($temp);
        $temp.val($("#JSON-preview").text()).select();
        document.execCommand("copy");
        $temp.remove();
        console.log($("#JSON-preview").text());
    }

    function download() {
        console.log("download");
        update();
    }

    function update() {
        console.log("updating")
        google.script.run.withSuccessHandler(onUpdate).convertToJSON(columnArray);
    }

    function onUpdate(data) {
        json = data;
        $("#JSON-preview").text(json);
        console.log("updated");
    }

    function setColumnArray() {
        console.log("set Column Array");
        var columnId = $("#columnArrayId").val().toUpperCase();
        var alreadyInArray = false;
        if (!columnArray.includes(columnId)) {
            columnArray.push(columnId);
        }
        $("#column-array-list").text(columnArray.join(","));
        console.log(columnArray);
    }

    function deleteColumnArray() {
        console.log("delete Column Array");
        var columnId = $("#columnArrayId").val().toUpperCase();
        columnArray = columnArray.filter(el => el != columnId);
        $("#column-array-list").text(columnArray.join(","));
        console.log(columnArray);
    }

    function lettersOnly() {
        var textletters = $("#columnArrayId").val();
        console.log("before : " + JSON.stringify(textletters));
        textletters = textletters.replace(/[^a-z]/gi, "");
        console.log("after : " + JSON.stringify(textletters));
        $("#columnArrayId").val(textletters);
    }
</script>